# ğŸ“ Diagramas de Arquitectura

## 1. Capas de Clean Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  PRESENTATION LAYER (UI + Controllers)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MainWindow (PySide6)                                 â”‚    â”‚
â”‚  â”‚  - Status display                                     â”‚    â”‚
â”‚  â”‚  - Network selection dropdown                         â”‚    â”‚
â”‚  â”‚  - Progress bar                                       â”‚    â”‚
â”‚  â”‚  - Start/Stop buttons                                 â”‚    â”‚
â”‚  â”‚  - Server logs viewer                                 â”‚    â”‚
â”‚  â”‚  - System tray integration                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                     â”‚
â”‚                          â”‚ Llama a                             â”‚
â”‚                          â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Workers (QThreads)                                   â”‚    â”‚
â”‚  â”‚  - StartServerWorker                                  â”‚    â”‚
â”‚  â”‚  - StopServerWorker                                   â”‚    â”‚
â”‚  â”‚  - CheckStatusWorker                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Ejecuta
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  DOMAIN LAYER (Business Logic)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Use Cases                                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ StartServerUseCase.execute():                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  1. Check lock                                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  2. Acquire lock                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  3. Sync download (R2 â†’ Local)                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  4. Update server.properties                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  5. Start Java process                         â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ StopServerUseCase.execute():                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  1. Send "stop" command                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  2. Wait for clean shutdown                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  3. Sync upload (Local â†’ R2)                   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  4. Release lock                               â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                     â”‚
â”‚                          â”‚ Usa interfaces (Puertos)            â”‚
â”‚                          â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Interfaces (Ports)                                   â”‚    â”‚
â”‚  â”‚  - ILockService                                       â”‚    â”‚
â”‚  â”‚  - ISyncService                                       â”‚    â”‚
â”‚  â”‚  - IServerManager                                     â”‚    â”‚
â”‚  â”‚  - INetworkProvider                                   â”‚    â”‚
â”‚  â”‚  - IConfigRepository                                  â”‚    â”‚
â”‚  â”‚  - IServerPropertiesManager                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†‘                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Implementadas por
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚  INFRASTRUCTURE + DATA LAYERS                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Infrastructure (External Services)                   â”‚    â”‚
â”‚  â”‚  - RcloneService        â†’ rclone.exe                  â”‚    â”‚
â”‚  â”‚  - R2LockService        â†’ boto3 (AWS SDK)             â”‚    â”‚
â”‚  â”‚  - ServerManager        â†’ subprocess (Java)           â”‚    â”‚
â”‚  â”‚  - NetworkProvider      â†’ psutil                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Data (Repositories)                                  â”‚    â”‚
â”‚  â”‚  - ConfigRepository     â†’ config.json                 â”‚    â”‚
â”‚  â”‚  - PropertiesManager    â†’ server.properties           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Flujo Completo: Iniciar Servidor

```
   USUARIO                  UI                   WORKER              USE CASE           SERVICES
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚ Clic "Iniciar"      â”‚                      â”‚                    â”‚                  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚ Crear Worker         â”‚                    â”‚                  â”‚
      â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚ worker.start()       â”‚                    â”‚                  â”‚
      â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚ use_case.execute() â”‚                  â”‚
      â”‚                     â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚ check_lock()     â”‚
      â”‚                     â”‚                      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚ GET /server.lock
      â”‚                     â”‚                      â”‚                    â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> R2
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚ lock info / None â”‚
      â”‚                     â”‚                      â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚ acquire_lock()   â”‚
      â”‚                     â”‚                      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚ PUT /server.lock
      â”‚                     â”‚                      â”‚                    â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> R2
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚ success          â”‚
      â”‚                     â”‚                      â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚ progress_update      â”‚                    â”‚ sync_download()  â”‚
      â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚ "Descargando..."    â”‚                      â”‚                    â”‚                  â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚                  â”‚ rclone sync
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚   R2 â†’ Local
      â”‚                     â”‚                      â”‚                    â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚ progress_update      â”‚                    â”‚  [progreso]      â”‚
      â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ [Barra: 50%]        â”‚                      â”‚                    â”‚                  â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚ success          â”‚
      â”‚                     â”‚                      â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚ update_server_ip()
      â”‚                     â”‚                      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚ Edita
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚ server.properties
      â”‚                     â”‚                      â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚ start_server()   â”‚
      â”‚                     â”‚                      â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚ subprocess.Popen
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚   java -jar ...
      â”‚                     â”‚                      â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚ finished(success)    â”‚  (True, "OK")      â”‚                  â”‚
      â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚ "âœ… Iniciado"       â”‚                      â”‚                    â”‚                  â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                    â”‚                  â”‚
      â”‚                     â”‚                      â”‚                    â”‚                  â”‚
      â”‚ [Logs en vivo]      â”‚                      â”‚                    â”‚                  â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                         (Server process stdout)
```

## 3. SincronizaciÃ³n con Rclone (Detalle)

```
RcloneService                    Rclone Process              R2 Cloudflare
      â”‚                                â”‚                           â”‚
      â”‚ sync_download()                â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
      â”‚                                â”‚                           â”‚
      â”‚  subprocess.Popen([            â”‚                           â”‚
      â”‚    "rclone", "sync",           â”‚                           â”‚
      â”‚    "cloudflare:bucket",        â”‚                           â”‚
      â”‚    "./server",                 â”‚                           â”‚
      â”‚    "--progress",               â”‚                           â”‚
      â”‚    "--stats", "1s"             â”‚                           â”‚
      â”‚  ])                            â”‚                           â”‚
      â”‚                                â”‚                           â”‚
      â”‚                                â”‚ GET /bucket/server_files  â”‚
      â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                                â”‚                           â”‚
      â”‚                                â”‚ [List of files]           â”‚
      â”‚                                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                                â”‚                           â”‚
      â”‚                                â”‚ Download file1.dat        â”‚
      â”‚                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                                â”‚                           â”‚
      â”‚ stderr: "Transferred: 10M..."  â”‚ [Binary data]             â”‚
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                                â”‚                           â”‚
      â”‚ _parse_progress(line)          â”‚                           â”‚
      â”œâ”€> SyncProgress(                â”‚                           â”‚
      â”‚     transferred=10MB,          â”‚                           â”‚
      â”‚     total=100MB,               â”‚                           â”‚
      â”‚     speed=2MB/s,               â”‚                           â”‚
      â”‚     eta=45s                    â”‚                           â”‚
      â”‚   )                            â”‚                           â”‚
      â”‚                                â”‚                           â”‚
      â”‚ progress_callback(progress)    â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                         (Emite signal a UI)
      â†“
  UI actualiza barra de progreso
```

## 4. Sistema de Lock Distribuido

```
Player 1                R2 (server.lock)           Player 2
   â”‚                           â”‚                       â”‚
   â”‚ check_lock()              â”‚                       â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
   â”‚                           â”‚                       â”‚
   â”‚ 404 Not Found             â”‚                       â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
   â”‚ (Disponible)              â”‚                       â”‚
   â”‚                           â”‚                       â”‚
   â”‚ acquire_lock("P1")        â”‚                       â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
   â”‚                           â”‚                       â”‚
   â”‚ 200 OK                    â”‚                       â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
   â”‚                           â”‚                       â”‚
   â”‚ [Servidor corriendo...]   â”‚ {                     â”‚
   â”‚                           â”‚   owner: "P1",        â”‚
   â”‚                           â”‚   locked_at: "...",   â”‚
   â”‚                           â”‚   ip: "10.0.0.1"      â”‚
   â”‚                           â”‚ }                     â”‚
   â”‚                           â”‚                       â”‚
   â”‚                           â”‚       check_lock()    â”‚
   â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                           â”‚                       â”‚
   â”‚                           â”‚ 200 OK (lock exists)  â”‚
   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚                       â”‚
   â”‚                           â”‚       ğŸ”´ BLOQUEADO    â”‚
   â”‚                           â”‚                       â”‚
   â”‚ release_lock()            â”‚                       â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
   â”‚                           â”‚                       â”‚
   â”‚ 200 OK (deleted)          â”‚                       â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
   â”‚                           â”‚                       â”‚
   â”‚                           â”‚ (Lock eliminado)      â”‚
   â”‚                           â”‚                       â”‚
   â”‚                           â”‚       check_lock()    â”‚
   â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                           â”‚                       â”‚
   â”‚                           â”‚ 404 Not Found         â”‚
   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚                       â”‚
   â”‚                           â”‚       âœ… DISPONIBLE   â”‚
   â”‚                           â”‚                       â”‚
```

## 5. Multithreading con Qt

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAIN THREAD (UI Thread)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MainWindow                                           â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  def _start_server():                                â”‚  â”‚
â”‚  â”‚      worker = StartServerWorker(...)                 â”‚  â”‚
â”‚  â”‚      worker.progress_update.connect(self._on_progress)â”‚ â”‚
â”‚  â”‚      worker.finished.connect(self._on_finished)      â”‚  â”‚
â”‚  â”‚      worker.start()  â† Inicia nuevo thread          â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  def _on_progress(msg, progress):  â† Slot            â”‚  â”‚
â”‚  â”‚      self.progress_bar.setValue(progress.percentage) â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  def _on_finished(success, message):  â† Slot         â”‚  â”‚
â”‚  â”‚      self.status_label.setText(message)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†‘                                       â†‘            â”‚
â”‚         â”‚ Signal                                â”‚ Signal     â”‚
â”‚         â”‚ (thread-safe)                         â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                       â”‚
          â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKER THREAD                                  â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  StartServerWorker(QThread)                          â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  def run():  â† Este mÃ©todo corre en thread separado â”‚  â”‚
â”‚  â”‚      # Operaciones lentas aquÃ­                       â”‚  â”‚
â”‚  â”‚      loop = asyncio.new_event_loop()                 â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚      # Ejecutar caso de uso (puede tardar minutos)   â”‚  â”‚
â”‚  â”‚      success, msg = loop.run_until_complete(         â”‚  â”‚
â”‚  â”‚          self.use_case.execute(...)                  â”‚  â”‚
â”‚  â”‚      )                                                â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚      # Notificar a UI (thread-safe)                  â”‚  â”‚
â”‚  â”‚      self.progress_update.emit(msg, progress) â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚      self.finished.emit(success, msg) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚                                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                              â”‚
â”‚  âš ï¸ UI nunca se congela porque las operaciones pesadas      â”‚
â”‚     corren en un thread separado                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. Dependency Injection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DependencyContainer                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  __init__():                                         â”‚ â”‚
â”‚  â”‚    # Instanciar implementaciones concretas           â”‚ â”‚
â”‚  â”‚    self._lock_service = R2LockService(r2_config)    â”‚ â”‚
â”‚  â”‚    self._sync_service = RcloneService()             â”‚ â”‚
â”‚  â”‚    self._server_manager = MinecraftServerManager()  â”‚ â”‚
â”‚  â”‚    ...                                               â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  get_start_server_use_case():                        â”‚ â”‚
â”‚  â”‚    return StartServerUseCase(                        â”‚ â”‚
â”‚  â”‚      lock_service=self.get_lock_service(),  â†â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”
â”‚  â”‚      sync_service=self.get_sync_service(),  â†â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¤
â”‚  â”‚      server_manager=self.get_server_manager()â†â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¤
â”‚  â”‚    )                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
               â”‚                                   â”‚     â”‚
               â”‚ Retorna interfaces                â”‚     â”‚
               â†“                                   â†“     â†“
      ILockService                        ISyncService  IServerManager
      (Contrato)                          (Contrato)    (Contrato)
           â†‘                                   â†‘             â†‘
           â”‚ Implementa                        â”‚             â”‚
           â”‚                                   â”‚             â”‚
    R2LockService                       RcloneService  MinecraftServerManager
    (ImplementaciÃ³n)                    (ImplementaciÃ³n) (ImplementaciÃ³n)

âš¡ Ventaja para Testing:
   Mock implementations se inyectan fÃ¡cilmente:
   
   mock_lock = MockLockService()
   use_case = StartServerUseCase(lock_service=mock_lock, ...)
```

## 7. Arquitectura de Archivos (Runtime)

```
Estructura durante ejecuciÃ³n:

Pass the host/
â”‚
â”œâ”€â”€ MinecraftServerLauncher.exe  â† Ejecutable generado
â”‚   (o python main.py en desarrollo)
â”‚
â”œâ”€â”€ config.json  â† ConfiguraciÃ³n
â”‚   {
â”‚     "r2": { "endpoint": "...", "access_key": "...", ... },
â”‚     "server": { "server_path": "./server", ... },
â”‚     "app": { "owner_name": "Player1", ... }
â”‚   }
â”‚
â”œâ”€â”€ app.log  â† Logs de la aplicaciÃ³n
â”‚
â”œâ”€â”€ rclone/
â”‚   â””â”€â”€ rclone.exe  â† Binario para sincronizaciÃ³n
â”‚
â”œâ”€â”€ java_runtime/
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ java.exe  â† JRE portable
â”‚
â”œâ”€â”€ server/  â† Archivos del servidor (sincronizados con R2)
â”‚   â”œâ”€â”€ server.jar
â”‚   â”œâ”€â”€ server.properties  â† Se actualiza con IP seleccionada
â”‚   â”œâ”€â”€ eula.txt
â”‚   â”œâ”€â”€ world/
â”‚   â”‚   â”œâ”€â”€ region/
â”‚   â”‚   â”œâ”€â”€ level.dat
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ logs/
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ src/  â† CÃ³digo fuente (solo en desarrollo)
    â”œâ”€â”€ domain/
    â”œâ”€â”€ data/
    â”œâ”€â”€ infrastructure/
    â””â”€â”€ presentation/
```

---

**Nota**: Estos diagramas representan la arquitectura actual implementada.
Para mÃ¡s detalles, consulta [ARCHITECTURE.md](ARCHITECTURE.md).
